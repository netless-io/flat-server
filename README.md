# flat-server

This project is the backend server for [flat-desktop](https://github.com/netless-io/flat-desktop).

### Features

* Register and login with Wechat.

### Development

Create these files with the format of `config/.env.default`:

* `config/.env.development.local`
* `config/.env.production.local`

See [Building Guides](#Building-Guides) for available variables.

Then at project root, run:

```shell
yarn install --frozen-lockfile
yarn run start
```

### Building Guides

You should <kbd>Fork</kbd> this project then add the environment variables at `https://github.com/[user-name]/flat-server/settings/secrets/actions`.

Available environment variables:

|  Name   | Description  |
|  ----  | ----  |
| DOCKERHUB_USERNAME | Your [hub.docker.com](https://hub.docker.com) user name |
| DOCKERHUB_TOKEN    | The generated `token` at hub.docker [settings](https://hub.docker.com/settings/security) |
| SERVER_PORT        | The exposed public port of deployed service |
| WECHAT_APP_ID      | `AppID` of `Website Apps` on [Wechat Open Platform](https://open.weixin.qq.com/) |
| WECHAT_APP_SECRET  | `AppSecret` of `Website Apps` on [Wechat Open Platform](https://open.weixin.qq.com/) |
| REDIS_HOST         | redis host |
| REDIS_PORT         | redis port |
| REDIS_PASSWORD     | redis password |
| REDIS_DB           | redis `db` name |
| MYSQL_HOST         | MySQL host |
| MYSQL_PORT         | MySQL port |
| MYSQL_USER         | MySQL user name |
| MYSQL_PASSWORD     | MySQL password |
| MYSQL_DB           | MySQL database name |
| SSH_HOST           | Deployed SSH address |
| SSH_USERNAME       | SSH user name |
| SSH_KEY            | SSH key |
| SSH_PORT           | SSH port |

Note that `SSH_KEY` is the secret key that is generated by `ssh-keygen -t rsa -b 4096`ï¼ˆstarting with `-----BEGIN OPENSSH PRIVATE KEY-----`).

Then at the remote server, add the `ssh` public key to ` ~/.ssh/authorized_keys`.

### Tech Stack

* [Node.js](https://github.com/nodejs/node)
* [TypeScript](https://github.com/microsoft/TypeScript)
* [MySQL](https://github.com/mysql/mysql-server)
* [Redis](https://github.com/redis/redis)
* [Fastify](https://github.com/fastify/fastify)
* [Socket.IO](https://github.com/socketio/socket.io)
